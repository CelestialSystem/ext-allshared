"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports._getDefaultVars = _getDefaultVars;
exports._extractFromSource = _extractFromSource;
exports._toProd = _toProd;
exports._toDev = _toDev;
exports._getAllComponents = _getAllComponents;
exports._writeFilesToProdFolder = _writeFilesToProdFolder;

var _allComponents = _interopRequireDefault(require("./allComponents"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _getDefaultVars() {
  return {
    touchFile: '/src/themer.js',
    watchStarted: false,
    buildstep: '1 of 1',
    firstTime: true,
    firstCompile: true,
    browserCount: 0,
    manifest: null,
    extPath: 'ext',
    pluginErrors: [],
    deps: [],
    usedExtComponents: [],
    rebuild: true
  };
}

function _extractFromSource(module, options, compilation) {
  const logv = require('./pluginUtil').logv;

  const verbose = options.verbose;
  logv(verbose, 'FUNCTION _extractFromSource');
  var js = module._source._value;
  logv(verbose, module.resource);
  var statements = [];

  var generate = require("@babel/generator").default;

  var parse = require("babylon").parse;

  var traverse = require("ast-traverse");

  var ast = parse(js, {
    plugins: ['typescript', 'flow', 'doExpressions', 'objectRestSpread', 'classProperties', 'exportDefaultFrom', 'exportExtensions', 'asyncGenerators', 'functionBind', 'functionSent', 'dynamicImport'],
    sourceType: 'module'
  });
  traverse(ast, {
    pre: function (node) {
      if (node.type === 'CallExpression' && node.callee && node.callee.object && node.callee.object.name === 'Ext') {
        statements.push(generate(node).code);
      }

      if (node.type === 'StringLiteral') {
        let code = node.value;

        for (var i = 0; i < code.length; ++i) {
          if (code.charAt(i) == '<') {
            if (code.substr(i, 4) == '<!--') {
              i += 4;
              i += code.substr(i).indexOf('-->') + 3;
            } else if (code.charAt(i + 1) !== '/') {
              var start = code.substring(i);
              var end = getEnd(start, [' ', '\n', '>']);
              var xtype = start.substring(1, end);

              if (_allComponents.default.includes(xtype)) {
                xtype = xtype.substring(4, end);
                var theValue = node.value.toLowerCase();

                if (theValue.indexOf('doctype html') == -1) {
                  var config = `Ext.create(${JSON.stringify({
                    xtype: xtype
                  })})`;

                  if (statements.indexOf(config) === -1) {
                    statements.push(config);
                  }
                }
              }

              i += end;
            }
          }
        }

        const xtypeRepetitons = (code.match(/xtype/g) || []).length;

        if (xtypeRepetitons > 0) {
          for (var j = 0; j < xtypeRepetitons; j++) {
            var start = code.substring(code.indexOf('xtype') + 5);
            var ifAsProps = start.indexOf(':');
            var ifAsAttribute = start.indexOf('=');
            start = start.substring(Math.min(ifAsProps, ifAsAttribute) + 1);
            var end = getEnd(start, [' ', '\n', '>', '}']);
            var xtype = start.substring(1, end).trim().replace(/['"]/g, '');
            var config = `Ext.create(${JSON.stringify({
              xtype: xtype
            })})`;

            if (_allComponents.default.includes('ext-' + xtype) && statements.indexOf(config) === -1) {
              statements.push(config);
            }
          }
        }
      }
    }
  });
  return statements;
}

function _toProd(vars, options) {
  const logv = require('./pluginUtil').logv;

  logv(options.verbose, 'FUNCTION _toProd (empty');

  try {} catch (e) {
    console.log(e);
    return [];
  }
}

function _toDev(vars, options) {
  try {} catch (e) {
    console.log(e);
    return [];
  }
}

function _getAllComponents(vars, options) {
  const logv = require('./pluginUtil').logv;

  logv(options.verbose, 'FUNCTION _getAllComponents (empty)');

  try {
    var extComponents = [];
    return extComponents;
  } catch (e) {
    console.log(e);
    return [];
  }
}

function _writeFilesToProdFolder(vars, options) {
  const logv = require('./pluginUtil').logv;

  logv(options.verbose, 'FUNCTION _writeFilesToProdFolder (empty)');

  try {} catch (e) {
    console.log(e);
  }
}

function getEnd(start, setOfSymbolsToCheck) {
  var endingsArr = [];

  for (var i = 0; i < setOfSymbolsToCheck.length; i++) {
    var symbolIndex = start.indexOf(setOfSymbolsToCheck[i]);

    if (symbolIndex !== -1) {
      endingsArr.push(symbolIndex);
    }
  }

  return Math.min(...endingsArr);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21wb25lbnRzVXRpbC5qcyJdLCJuYW1lcyI6WyJfZ2V0RGVmYXVsdFZhcnMiLCJ0b3VjaEZpbGUiLCJ3YXRjaFN0YXJ0ZWQiLCJidWlsZHN0ZXAiLCJmaXJzdFRpbWUiLCJmaXJzdENvbXBpbGUiLCJicm93c2VyQ291bnQiLCJtYW5pZmVzdCIsImV4dFBhdGgiLCJwbHVnaW5FcnJvcnMiLCJkZXBzIiwidXNlZEV4dENvbXBvbmVudHMiLCJyZWJ1aWxkIiwiX2V4dHJhY3RGcm9tU291cmNlIiwibW9kdWxlIiwib3B0aW9ucyIsImNvbXBpbGF0aW9uIiwibG9ndiIsInJlcXVpcmUiLCJ2ZXJib3NlIiwianMiLCJfc291cmNlIiwiX3ZhbHVlIiwicmVzb3VyY2UiLCJzdGF0ZW1lbnRzIiwiZ2VuZXJhdGUiLCJkZWZhdWx0IiwicGFyc2UiLCJ0cmF2ZXJzZSIsImFzdCIsInBsdWdpbnMiLCJzb3VyY2VUeXBlIiwicHJlIiwibm9kZSIsInR5cGUiLCJjYWxsZWUiLCJvYmplY3QiLCJuYW1lIiwicHVzaCIsImNvZGUiLCJ2YWx1ZSIsImkiLCJsZW5ndGgiLCJjaGFyQXQiLCJzdWJzdHIiLCJpbmRleE9mIiwic3RhcnQiLCJzdWJzdHJpbmciLCJlbmQiLCJnZXRFbmQiLCJ4dHlwZSIsImFsbENvbXBvbmVudHMiLCJpbmNsdWRlcyIsInRoZVZhbHVlIiwidG9Mb3dlckNhc2UiLCJjb25maWciLCJKU09OIiwic3RyaW5naWZ5IiwieHR5cGVSZXBldGl0b25zIiwibWF0Y2giLCJqIiwiaWZBc1Byb3BzIiwiaWZBc0F0dHJpYnV0ZSIsIk1hdGgiLCJtaW4iLCJ0cmltIiwicmVwbGFjZSIsIl90b1Byb2QiLCJ2YXJzIiwiZSIsImNvbnNvbGUiLCJsb2ciLCJfdG9EZXYiLCJfZ2V0QWxsQ29tcG9uZW50cyIsImV4dENvbXBvbmVudHMiLCJfd3JpdGVGaWxlc1RvUHJvZEZvbGRlciIsInNldE9mU3ltYm9sc1RvQ2hlY2siLCJlbmRpbmdzQXJyIiwic3ltYm9s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QUMsY0FBRCxDQUFQLENBQXdCRCxJQUFyQzs7QUFDQUEsRUFBQUEsSUFBSSxDQUFDRixPQUFPLENBQUNJLE9BQVQsRUFBaUIsMENBQWpCLENBQUo7O0FBQ0EsTUFBSSxDQUNILENBREQsQ0FFQSxPQUFPa0QsQ0FBUCxFQUFVO0FBQ1JDLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRixDQUFaO0FBQ0Q7QUFDRjs7QUFFRCxTQUFTcEIsTUFBVCxDQUFnQkgsS0FBaEIsRUFBdUI4QixtQkFBdkIsRUFBNEM7QUFDMUMsTUFBSUMsVUFBVSxHQUFHLEVBQWpCOztBQUVBLE9BQUssSUFBSXBDLENBQUMsR0FBQyxDQUFYLEVBQWFBLENBQUMsR0FBQ21DLG1CQUFtQixDQUFDbEMsTUFBbkMsRUFBMENELENBQUMsRUFBM0MsRUFBK0M7QUFDNUMsUUFBSXFDLFdBQVcsR0FBR2hDLEtBQUssQ0FBQ0QsT0FBTixDQUFjK0IsbUJBQW1CLENBQUNuQyxDQUFELENBQWpDLENBQWxCOztBQUVBLFFBQUlxQyxXQUFXLEtBQUssQ0FBQyxDQUFyQixFQUF3QjtBQUN0QkQsTUFBQUEsVUFBVSxDQUFDdkMsSUFBWCxDQUFnQndDLFdBQWhCO0FBQ0Q7QUFDSDs7QUFDRCxTQUFPZixJQUFJLENBQUNDLEdBQUwsQ0FBUyxHQUFHYSxVQUFaLENBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIlxuXCJ1c2Ugc3RyaWN0XCJcbmltcG9ydCBhbGxDb21wb25lbnRzIGZyb20gJy4vYWxsQ29tcG9uZW50cyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBfZ2V0RGVmYXVsdFZhcnMoKSB7XG4gIHJldHVybiB7XG4gICAgdG91Y2hGaWxlOiAnL3NyYy90aGVtZXIuanMnLFxuICAgIHdhdGNoU3RhcnRlZCA6IGZhbHNlLFxuICAgIGJ1aWxkc3RlcDogJzEgb2YgMScsXG4gICAgZmlyc3RUaW1lIDogdHJ1ZSxcbiAgICBmaXJzdENvbXBpbGU6IHRydWUsXG4gICAgYnJvd3NlckNvdW50IDogMCxcbiAgICBtYW5pZmVzdDogbnVsbCxcbiAgICBleHRQYXRoOiAnZXh0JyxcbiAgICBwbHVnaW5FcnJvcnM6IFtdLFxuICAgIGRlcHM6IFtdLFxuICAgIHVzZWRFeHRDb21wb25lbnRzOiBbXSxcbiAgICByZWJ1aWxkOiB0cnVlXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9leHRyYWN0RnJvbVNvdXJjZShtb2R1bGUsIG9wdGlvbnMsIGNvbXBpbGF0aW9uKSB7XG4gIGNvbnN0IGxvZ3YgPSByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2d2XG4gIGNvbnN0IHZlcmJvc2UgPSBvcHRpb25zLnZlcmJvc2VcbiAgbG9ndih2ZXJib3NlLCdGVU5DVElPTiBfZXh0cmFjdEZyb21Tb3VyY2UnKVxuICB2YXIganMgPSBtb2R1bGUuX3NvdXJjZS5fdmFsdWVcbiAgbG9ndih2ZXJib3NlLG1vZHVsZS5yZXNvdXJjZSlcbiAgdmFyIHN0YXRlbWVudHMgPSBbXVxuXG4gIHZhciBnZW5lcmF0ZSA9IHJlcXVpcmUoXCJAYmFiZWwvZ2VuZXJhdG9yXCIpLmRlZmF1bHRcbiAgdmFyIHBhcnNlID0gcmVxdWlyZShcImJhYnlsb25cIikucGFyc2VcbiAgdmFyIHRyYXZlcnNlID0gcmVxdWlyZShcImFzdC10cmF2ZXJzZVwiKVxuXG4gIHZhciBhc3QgPSBwYXJzZShqcywge1xuICAgIHBsdWdpbnM6IFtcbiAgICAgICd0eXBlc2NyaXB0JyxcbiAgICAgICdmbG93JyxcbiAgICAgICdkb0V4cHJlc3Npb25zJyxcbiAgICAgICdvYmplY3RSZXN0U3ByZWFkJyxcbiAgICAgICdjbGFzc1Byb3BlcnRpZXMnLFxuICAgICAgJ2V4cG9ydERlZmF1bHRGcm9tJyxcbiAgICAgICdleHBvcnRFeHRlbnNpb25zJyxcbiAgICAgICdhc3luY0dlbmVyYXRvcnMnLFxuICAgICAgJ2Z1bmN0aW9uQmluZCcsXG4gICAgICAnZnVuY3Rpb25TZW50JyxcbiAgICAgICdkeW5hbWljSW1wb3J0J1xuICAgIF0sXG4gICAgc291cmNlVHlwZTogJ21vZHVsZSdcbiAgfSlcblxuICB0cmF2ZXJzZShhc3QsIHtcbiAgICBwcmU6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICBpZiAobm9kZS50eXBlID09PSAnQ2FsbEV4cHJlc3Npb24nICYmIG5vZGUuY2FsbGVlICYmIG5vZGUuY2FsbGVlLm9iamVjdCAmJiBub2RlLmNhbGxlZS5vYmplY3QubmFtZSA9PT0gJ0V4dCcpIHtcbiAgICAgICAgc3RhdGVtZW50cy5wdXNoKGdlbmVyYXRlKG5vZGUpLmNvZGUpXG4gICAgICB9XG4gICAgICBpZihub2RlLnR5cGUgPT09ICdTdHJpbmdMaXRlcmFsJykge1xuICAgICAgICBsZXQgY29kZSA9IG5vZGUudmFsdWVcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb2RlLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgaWYgKGNvZGUuY2hhckF0KGkpID09ICc8Jykge1xuICAgICAgICAgICAgaWYgKGNvZGUuc3Vic3RyKGksIDQpID09ICc8IS0tJykge1xuICAgICAgICAgICAgICBpICs9IDRcbiAgICAgICAgICAgICAgaSArPSBjb2RlLnN1YnN0cihpKS5pbmRleE9mKCctLT4nKSArIDNcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29kZS5jaGFyQXQoaSsxKSAhPT0gJy8nKSB7XG4gICAgICAgICAgICAgIHZhciBzdGFydCA9IGNvZGUuc3Vic3RyaW5nKGkpXG4gICAgICAgICAgICAgIHZhciBlbmQgPSBnZXRFbmQoc3RhcnQsIFsnICcsICdcXG4nLCAnPiddKTtcblxuICAgICAgICAgICAgICAgIHZhciB4dHlwZSA9IHN0YXJ0LnN1YnN0cmluZygxLCBlbmQpXG4gICAgICAgICAgICAgICAgaWYoYWxsQ29tcG9uZW50cy5pbmNsdWRlcyh4dHlwZSkpIHtcbiAgICAgICAgICAgICAgICAgIHh0eXBlID0geHR5cGUuc3Vic3RyaW5nKDQsIGVuZCk7XG4gICAgICAgICAgICAgICAgICB2YXIgdGhlVmFsdWUgPSBub2RlLnZhbHVlLnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAgICAgICAgIGlmICh0aGVWYWx1ZS5pbmRleE9mKCdkb2N0eXBlIGh0bWwnKSA9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlnID0gYEV4dC5jcmVhdGUoJHtKU09OLnN0cmluZ2lmeSh7eHR5cGU6IHh0eXBlfSl9KWA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZW1lbnRzLmluZGV4T2YoY29uZmlnKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICBzdGF0ZW1lbnRzLnB1c2goY29uZmlnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpICs9IGVuZFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgeHR5cGVSZXBldGl0b25zID0gKGNvZGUubWF0Y2goL3h0eXBlL2cpIHx8IFtdKS5sZW5ndGg7XG4gICAgICAgICAgaWYgKHh0eXBlUmVwZXRpdG9ucyA+IDApIHtcbiAgICAgICAgICAgIGZvciAodmFyIGo9MDsgajx4dHlwZVJlcGV0aXRvbnM7IGorKykge1xuICAgICAgICAgICAgICB2YXIgc3RhcnQgPSBjb2RlLnN1YnN0cmluZyhjb2RlLmluZGV4T2YoJ3h0eXBlJykgKyA1KTtcbiAgICAgICAgICAgICAgdmFyIGlmQXNQcm9wcyA9IHN0YXJ0LmluZGV4T2YoJzonKTtcbiAgICAgICAgICAgICAgdmFyIGlmQXNBdHRyaWJ1dGUgPSBzdGFydC5pbmRleE9mKCc9Jyk7XG4gICAgICAgICAgICAgIHN0YXJ0ID0gc3RhcnQuc3Vic3RyaW5nKE1hdGgubWluKGlmQXNQcm9wcywgaWZBc0F0dHJpYnV0ZSkgKyAxKTtcbiAgICAgICAgICAgICAgdmFyIGVuZCA9IGdldEVuZChzdGFydCwgWycgJywgJ1xcbicsICc+JywnfSddKVxuICAgICAgICAgICAgICB2YXIgeHR5cGUgPSBzdGFydC5zdWJzdHJpbmcoMSwgZW5kKS50cmltKCkucmVwbGFjZSgvWydcIl0vZywgJycpO1xuICAgICAgICAgICAgICB2YXIgY29uZmlnID0gYEV4dC5jcmVhdGUoJHtKU09OLnN0cmluZ2lmeSh7eHR5cGU6IHh0eXBlfSl9KWA7XG5cbiAgICAgICAgICAgICAgaWYoYWxsQ29tcG9uZW50cy5pbmNsdWRlcygnZXh0LScgKyB4dHlwZSkgJiYgc3RhdGVtZW50cy5pbmRleE9mKGNvbmZpZykgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgc3RhdGVtZW50cy5wdXNoKGNvbmZpZyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHN0YXRlbWVudHNcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF90b1Byb2QodmFycywgb3B0aW9ucykge1xuICBjb25zdCBsb2d2ID0gcmVxdWlyZSgnLi9wbHVnaW5VdGlsJykubG9ndlxuICBsb2d2KG9wdGlvbnMudmVyYm9zZSwnRlVOQ1RJT04gX3RvUHJvZCAoZW1wdHknKVxuICB0cnkge1xuICB9XG4gIGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5sb2coZSlcbiAgICByZXR1cm4gW11cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gX3RvRGV2KHZhcnMsIG9wdGlvbnMpIHtcbiAgdHJ5IHtcbiAgfVxuICBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUubG9nKGUpXG4gICAgcmV0dXJuIFtdXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9nZXRBbGxDb21wb25lbnRzKHZhcnMsIG9wdGlvbnMpIHtcbiAgIGNvbnN0IGxvZ3YgPSByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2d2XG4gIGxvZ3Yob3B0aW9ucy52ZXJib3NlLCdGVU5DVElPTiBfZ2V0QWxsQ29tcG9uZW50cyAoZW1wdHkpJylcbiAgdHJ5IHtcbiAgICB2YXIgZXh0Q29tcG9uZW50cyA9IFtdXG4gICAgIHJldHVybiBleHRDb21wb25lbnRzXG4gIH1cbiAgY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmxvZyhlKVxuICAgIHJldHVybiBbXVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfd3JpdGVGaWxlc1RvUHJvZEZvbGRlcih2YXJzLCBvcHRpb25zKSB7XG4gIGNvbnN0IGxvZ3YgPSByZXF1aXJlKCcuL3BsdWdpblV0aWwnKS5sb2d2XG4gIGxvZ3Yob3B0aW9ucy52ZXJib3NlLCdGVU5DVElPTiBfd3JpdGVGaWxlc1RvUHJvZEZvbGRlciAoZW1wdHkpJylcbiAgdHJ5IHtcbiAgfVxuICBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUubG9nKGUpXG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0RW5kKHN0YXJ0LCBzZXRPZlN5bWJvbHNUb0NoZWNrKSB7XG4gIHZhciBlbmRpbmdzQXJyID0gW107XG5cbiAgZm9yICh2YXIgaT0wO2k8c2V0T2ZTeW1ib2xzVG9DaGVjay5sZW5ndGg7aSsrKSB7XG4gICAgIHZhciBzeW1ib2xJbmRleCA9IHN0YXJ0LmluZGV4T2Yoc2V0T2ZTeW1ib2xzVG9DaGVja1tpXSk7XG5cbiAgICAgaWYgKHN5bWJvbEluZGV4ICE9PSAtMSkge1xuICAgICAgIGVuZGluZ3NBcnIucHVzaChzeW1ib2xJbmRleCk7XG4gICAgIH1cbiAgfVxuICByZXR1cm4gTWF0aC5taW4oLi4uZW5kaW5nc0Fycilcbn1cbiJdfQ==