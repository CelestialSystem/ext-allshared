'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require('@babel/polyfill');

const fs = require('fs');

const path = require('path');

const pluginUtil = require(`./pluginUtil`); // process.stdin.resume();
// process.on('SIGINT', function () {
//   console.log('Got SIGINT.  Press Control-D to exit.');
// });


class ExtWebpackPlugin {
  constructor(options) {
    var constructorOutput = pluginUtil._constructor(options);

    this.vars = constructorOutput.vars;
    this.options = constructorOutput.options;
  }

  apply(compiler) {
    const vars = this.vars;
    const options = this.options;
    const app = this.app;

    if (!compiler.hooks) {
      console.log('not webpack 4');
      return;
    }

    compiler.hooks.thisCompilation.tap(`ext-this-compilation`, compilation => {
      pluginUtil.logh(app, `HOOK thisCompilation`);

      pluginUtil._thisCompilation(compiler, compilation, vars, options);

      if (vars.pluginErrors.length > 0) {
        compilation.errors.push(new Error(vars.pluginErrors.join("")));
        return;
      }
    }); //var cRun = 0;

    compiler.hooks.compilation.tap(`ext-compilation`, compilation => {
      pluginUtil.logh(app, `HOOK compilation`); //if (cRun == 0) {

      pluginUtil._compilation(compiler, compilation, vars, options); //}
      //cRun++;

    });
    compiler.hooks.afterCompile.tap('ext-after-compile', compilation => {
      pluginUtil.logh(app, `HOOK afterCompile`);

      pluginUtil._afterCompile(compiler, compilation, vars, options);
    });
    compiler.hooks.emit.tapAsync(`ext-emit`, (compilation, callback) => {
      pluginUtil.logh(app, `HOOK emit (async)`);

      pluginUtil._emit(compiler, compilation, vars, options, callback);
    });
    compiler.hooks.done.tap(`ext-done`, stats => {
      pluginUtil.logh(app, `HOOK done`);
      this.postBuildProcess(stats.compilation.outputOptions);

      pluginUtil._done(stats, vars, options);
    });
  }

  postBuildProcess(options) {
    /**
       * 1. Read the temp file written by the Cmd plugin to get the app.json configured build path
       * 2. Extract the path as a String, trimmed to the location of the build folder
       * 3. Copy webpack bundle and index.html to destination directory
       * 4. Delete the temp file
       */
    const outputPath = options.path;
    const bundleName = options.filename == "[name].js" ? "main.js" : options.filename;
    const indexHTML = "index.html";
    const indexPath = outputPath + indexHTML;
    const tempFilePath = outputPath + 'temp.txt';
    const buildFolder = "build";

    if (fs.existsSync(tempFilePath)) {
      const configProdPath = fs.readFileSync(tempFilePath, "utf8").toString().trim();
      fs.unlinkSync(tempFilePath);
      const trimmedProdPathIndex = configProdPath.indexOf(buildFolder);
      const prodBuildPath = configProdPath.substring(trimmedProdPathIndex);
      const copyBundleDest = path.join(prodBuildPath, bundleName);
      const copyIndexDest = path.join(prodBuildPath, indexHTML);

      if (fs.existsSync(bundleName)) {
        fs.copyFileSync(bundleName, copyBundleDest);
        fs.copyFileSync(indexHTML, copyIndexDest);
      }
    }
  }

}

exports.default = ExtWebpackPlugin;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiZnMiLCJwYXRoIiwicGx1Z2luVXRpbCIsIkV4dFdlYnBhY2tQbHVnaW4iLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJjb25zdHJ1Y3Rvck91dHB1dCIsIl9jb25zdHJ1Y3RvciIsInZhcnMiLCJhcHBseSIsImNvbXBpbGVyIiwiYXBwIiwiaG9va3MiLCJjb25zb2xlIiwibG9nIiwidGhpc0NvbXBpbGF0aW9uIiwidGFwIiwiY29tcGlsYXRpb24iLCJsb2doIiwiX3RoaXNDb21waWxhdGlvbiIsInBsdWdpbkVycm9ycyIsImxlbmd0aCIsImVycm9ycyIsInB1c2giLCJFcnJvciIsImpvaW4iLCJfY29tcGlsYXRpb24iLCJhZnRlckNvbXBpbGUiLCJfYWZ0ZXJDb21waWxlIiwiZW1pdCIsInRhcEFzeW5jIiwiY2FsbGJhY2siLCJfZW1pdCIsImRvbmUiLCJzdGF0cyIsInBvc3RCdWlsZFByb2Nlc3MiLCJvdXRwdXRPcHRpb25zIiwiX2RvbmUiLCJvdXRwdXRQYXRoIiwiYnVuZGxlTmFtZSIsImZpbGVuYW1lIiwiaW5kZXhIVE1MIiwiaW5kZXhQYXRoIiwidGVtcEZpbGVQYXRoIiwiYnVpbGRGb2xkZXIiLCJleGlzdHNTeW5jIiwiY29uZmlnUHJvZFBhdGgiLCJyZWFkRmlsZVN5bmMiLCJ0b1N0cmluZyIsInRyaW0iLCJ1bmxpbmtTeW5jIiwidHJpbW1lZFByb2RQYXRoSW5kZXgiLCJpbmRleE9mIiwicHJvZEJ1aWxkUGF0aCIsInN1YnN0cmluZyIsImNvcHlCdW5kbGVEZXN0IiwiY29weUluZGV4RGVzdCIsImNvcHlGaWxlU3luYyJdLCJtYXBwaW5ncyI6IkFBQ0E7Ozs7Ozs7QUFDQUEsT0FBTyxDQUFDLGlCQUFELENBQVA7O0FBQ0EsTUFBTUMsRUFBRSxHQUFHRCxPQUFPLENBQUMsSUFBRCxDQUFsQjs7QUFDQSxNQUFNRSxJQUFJLEdBQUdGLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNB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YUFBVixFQUF5QlosU0FBekIsQ0FBdEI7O0FBQ0EsVUFBSXpDLEVBQUUsQ0FBQzZDLFVBQUgsQ0FBY04sVUFBZCxDQUFKLEVBQStCO0FBQzdCdkMsUUFBQUEsRUFBRSxDQUFDeUQsWUFBSCxDQUFnQmxCLFVBQWhCLEVBQTRCZ0IsY0FBNUI7QUFDQXZELFFBQUFBLEVBQUUsQ0FBQ3lELFlBQUgsQ0FBZ0JoQixTQUFoQixFQUEyQmUsYUFBM0I7QUFDRDtBQUNGO0FBQ0o7O0FBaEZtQyIsInNvdXJjZXNDb250ZW50IjpbIlxuJ3VzZSBzdHJpY3QnXG5yZXF1aXJlKCdAYmFiZWwvcG9seWZpbGwnKVxuY29uc3QgZnMgPSByZXF1aXJlKCdmcycpO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IHBsdWdpblV0aWwgPSByZXF1aXJlKGAuL3BsdWdpblV0aWxgKVxuXG4vLyBwcm9jZXNzLnN0ZGluLnJlc3VtZSgpO1xuXG4vLyBwcm9jZXNzLm9uKCdTSUdJTlQnLCBmdW5jdGlvbiAoKSB7XG4vLyAgIGNvbnNvbGUubG9nKCdHb3QgU0lHSU5ULiAgUHJlc3MgQ29udHJvbC1EIHRvIGV4aXQuJyk7XG4vLyB9KTtcblxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFeHRXZWJwYWNrUGx1Z2luIHtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgdmFyIGNvbnN0cnVjdG9yT3V0cHV0ID0gcGx1Z2luVXRpbC5fY29uc3RydWN0b3Iob3B0aW9ucylcbiAgICB0aGlzLnZhcnMgPSBjb25zdHJ1Y3Rvck91dHB1dC52YXJzXG4gICAgdGhpcy5vcHRpb25zID0gY29uc3RydWN0b3JPdXRwdXQub3B0aW9uc1xuICB9XG5cbiAgYXBwbHkoY29tcGlsZXIpIHtcbiAgICBjb25zdCB2YXJzID0gdGhpcy52YXJzXG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMub3B0aW9uc1xuICAgIGNvbnN0IGFwcCA9IHRoaXMuYXBwXG5cbiAgICBpZiAoIWNvbXBpbGVyLmhvb2tzKSB7XG4gICAgICBjb25zb2xlLmxvZygnbm90IHdlYnBhY2sgNCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbXBpbGVyLmhvb2tzLnRoaXNDb21waWxhdGlvbi50YXAoYGV4dC10aGlzLWNvbXBpbGF0aW9uYCwgKGNvbXBpbGF0aW9uKSA9PiB7XG4gICAgICBwbHVnaW5VdGlsLmxvZ2goYXBwLCBgSE9PSyB0aGlzQ29tcGlsYXRpb25gKVxuICAgICAgcGx1Z2luVXRpbC5fdGhpc0NvbXBpbGF0aW9uKGNvbXBpbGVyLCBjb21waWxhdGlvbiwgdmFycywgb3B0aW9ucylcblxuICAgICAgaWYgKHZhcnMucGx1Z2luRXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29tcGlsYXRpb24uZXJyb3JzLnB1c2goIG5ldyBFcnJvcih2YXJzLnBsdWdpbkVycm9ycy5qb2luKFwiXCIpKSApXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgIH0pXG5cbiAgICAvL3ZhciBjUnVuID0gMDtcbiAgICBjb21waWxlci5ob29rcy5jb21waWxhdGlvbi50YXAoYGV4dC1jb21waWxhdGlvbmAsIChjb21waWxhdGlvbikgPT4ge1xuICAgICAgcGx1Z2luVXRpbC5sb2doKGFwcCwgYEhPT0sgY29tcGlsYXRpb25gKVxuICAgICAgLy9pZiAoY1J1biA9PSAwKSB7XG4gICAgICAgIHBsdWdpblV0aWwuX2NvbXBpbGF0aW9uKGNvbXBpbGVyLCBjb21waWxhdGlvbiwgdmFycywgb3B0aW9ucyk7XG4gICAgICAvL31cbiAgICAgIC8vY1J1bisrO1xuICAgIH0pXG5cbiAgICBjb21waWxlci5ob29rcy5hZnRlckNvbXBpbGUudGFwKCdleHQtYWZ0ZXItY29tcGlsZScsIChjb21waWxhdGlvbikgPT4ge1xuICAgICAgcGx1Z2luVXRpbC5sb2doKGFwcCwgYEhPT0sgYWZ0ZXJDb21waWxlYClcbiAgICAgIHBsdWdpblV0aWwuX2FmdGVyQ29tcGlsZShjb21waWxlciwgY29tcGlsYXRpb24sIHZhcnMsIG9wdGlvbnMpXG4gICAgfSlcblxuICAgIGNvbXBpbGVyLmhvb2tzLmVtaXQudGFwQXN5bmMoYGV4dC1lbWl0YCwgKGNvbXBpbGF0aW9uLCBjYWxsYmFjaykgPT4ge1xuICAgICAgcGx1Z2luVXRpbC5sb2doKGFwcCwgYEhPT0sgZW1pdCAoYXN5bmMpYClcbiAgICAgIHBsdWdpblV0aWwuX2VtaXQoY29tcGlsZXIsIGNvbXBpbGF0aW9uLCB2YXJzLCBvcHRpb25zLCBjYWxsYmFjaylcbiAgICB9KVxuXG4gICAgY29tcGlsZXIuaG9va3MuZG9uZS50YXAoYGV4dC1kb25lYCwgKHN0YXRzKSA9PiB7XG4gICAgICBwbHVnaW5VdGlsLmxvZ2goYXBwLCBgSE9PSyBkb25lYClcbiAgICAgIHRoaXMucG9zdEJ1aWxkUHJvY2VzcyhzdGF0cy5jb21waWxhdGlvbi5vdXRwdXRPcHRpb25zKVxuICAgICAgcGx1Z2luVXRpbC5fZG9uZShzdGF0cywgdmFycywgb3B0aW9ucylcbiAgICB9KVxuICB9XG5cbiAgcG9zdEJ1aWxkUHJvY2VzcyhvcHRpb25zKSB7XG4gICAgLyoqXG4gICAgICAgKiAxLiBSZWFkIHRoZSB0ZW1wIGZpbGUgd3JpdHRlbiBieSB0aGUgQ21kIHBsdWdpbiB0byBnZXQgdGhlIGFwcC5qc29uIGNvbmZpZ3VyZWQgYnVpbGQgcGF0aFxuICAgICAgICogMi4gRXh0cmFjdCB0aGUgcGF0aCBhcyBhIFN0cmluZywgdHJpbW1lZCB0byB0aGUgbG9jYXRpb24gb2YgdGhlIGJ1aWxkIGZvbGRlclxuICAgICAgICogMy4gQ29weSB3ZWJwYWNrIGJ1bmRsZSBhbmQgaW5kZXguaHRtbCB0byBkZXN0aW5hdGlvbiBkaXJlY3RvcnlcbiAgICAgICAqIDQuIERlbGV0ZSB0aGUgdGVtcCBmaWxlXG4gICAgICAgKi8gXG4gICAgICBjb25zdCBvdXRwdXRQYXRoID0gb3B0aW9ucy5wYXRoO1xuICAgICAgY29uc3QgYnVuZGxlTmFtZSA9ICgob3B0aW9ucy5maWxlbmFtZSA9PSBcIltuYW1lXS5qc1wiKSA/IFwibWFpbi5qc1wiIDogb3B0aW9ucy5maWxlbmFtZSk7XG4gICAgICBjb25zdCBpbmRleEhUTUwgPSBcImluZGV4Lmh0bWxcIjtcbiAgICAgIGNvbnN0IGluZGV4UGF0aCA9IG91dHB1dFBhdGgraW5kZXhIVE1MO1xuICAgICAgY29uc3QgdGVtcEZpbGVQYXRoID0gb3V0cHV0UGF0aCsndGVtcC50eHQnO1xuICAgICAgY29uc3QgYnVpbGRGb2xkZXIgPSBcImJ1aWxkXCJcblxuICAgICAgaWYgKGZzLmV4aXN0c1N5bmModGVtcEZpbGVQYXRoKSkge1xuICAgICAgICBjb25zdCBjb25maWdQcm9kUGF0aCA9IGZzLnJlYWRGaWxlU3luYyh0ZW1wRmlsZVBhdGgsIFwidXRmOFwiKS50b1N0cmluZygpLnRyaW0oKTtcbiAgICAgICAgZnMudW5saW5rU3luYyh0ZW1wRmlsZVBhdGgpO1xuICAgICAgICBjb25zdCB0cmltbWVkUHJvZFBhdGhJbmRleCA9IGNvbmZpZ1Byb2RQYXRoLmluZGV4T2YoYnVpbGRGb2xkZXIpO1xuICAgICAgICBjb25zdCBwcm9kQnVpbGRQYXRoID0gY29uZmlnUHJvZFBhdGguc3Vic3RyaW5nKHRyaW1tZWRQcm9kUGF0aEluZGV4KVxuICAgICAgICBjb25zdCBjb3B5QnVuZGxlRGVzdCA9IHBhdGguam9pbihwcm9kQnVpbGRQYXRoLCBidW5kbGVOYW1lKTtcbiAgICAgICAgY29uc3QgY29weUluZGV4RGVzdCA9IHBhdGguam9pbihwcm9kQnVpbGRQYXRoLCBpbmRleEhUTUwpO1xuICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhidW5kbGVOYW1lKSkge1xuICAgICAgICAgIGZzLmNvcHlGaWxlU3luYyhidW5kbGVOYW1lLCBjb3B5QnVuZGxlRGVzdCk7XG4gICAgICAgICAgZnMuY29weUZpbGVTeW5jKGluZGV4SFRNTCwgY29weUluZGV4RGVzdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgfVxufVxuIl19