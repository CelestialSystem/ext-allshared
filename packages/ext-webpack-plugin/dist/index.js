'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require('@babel/polyfill');

const p = require(`./pluginUtil`);

class ExtWebpackPlugin {
  constructor(options) {
    this.plugin = p._constructor(options);
  }

  apply(compiler) {
    const vars = this.plugin.vars;
    const options = this.plugin.options;

    if (!compiler.hooks) {
      console.log('not webpack 4');
      return;
    }

    compiler.hooks.thisCompilation.tap(`ext-this-compilation`, compilation => {
      p.logh(vars.app + `HOOK thisCompilation`);

      p._thisCompilation(compiler, compilation, vars, options);

      if (vars.pluginErrors.length > 0) {
        compilation.errors.push(new Error(vars.pluginErrors.join("")));
        return;
      }
    });
    compiler.hooks.compilation.tap(`ext-compilation`, compilation => {
      p.logh(vars.app + `HOOK compilation`);

      p._compilation(compiler, compilation, vars, options);
    });
    compiler.hooks.emit.tapAsync(`ext-emit`, (compilation, callback) => {
      p.logh(vars.app + `HOOK emit (async)`);

      p._emit(compiler, compilation, vars, options, callback);
    });
    compiler.hooks.afterCompile.tap('ext-after-compile', compilation => {
      p.logh(vars.app + `HOOK afterCompile`);

      p._afterCompile(compiler, compilation, vars, options);
    });
    compiler.hooks.done.tap(`ext-done`, () => {
      p.logh(vars.app + `HOOK done`);

      p._done(vars, options);
    });
  }

}

exports.default = ExtWebpackPlugin;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwicCIsIkV4dFdlYnBhY2tQbHVnaW4iLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJwbHVnaW4iLCJfY29uc3RydWN0b3IiLCJhcHBseSIsImNvbXBpbGVyIiwidmFycyIsImhvb2tzIiwiY29uc29sZSIsImxvZyIsInRoaXNDb21waWxhdGlvbiIsInRhcCIsImNvbXBpbGF0aW9uIiwibG9naCIsImFwcCIsIl90aGlzQ29tcGlsYXRpb24iLCJwbHVnaW5FcnJvcnMiLCJsZW5ndGgiLCJlcnJvcnMiLCJwdXNoIiwiRXJyb3IiLCJqb2luIiwiX2NvbXBpbGF0aW9uIiwiZW1pdCIsInRhcEFzeW5jIiwiY2FsbGJhY2siLCJfZW1pdCIsImFmdGVyQ29tcGlsZSIsIl9hZnRlckNvbXBpbGUiLCJkb25lIiwiX2RvbmUiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7O0FBQ0FBLE9BQU8sQ0FBQyxpQkFBRCxDQUFQOztBQUNBLE1BQU1DLENBQUMsR0FBR0QsT0FBTyxDQUFFLGNBQUYsQ0FBakI7O0FBRWUsTUFBTUUsZ0JBQU4sQ0FBdUI7QUFFcENDLEVBQUFBLFdBQVcsQ0FBQ0MsT0FBRCxFQUFVO0FBQ25CLFNBQUtDLE1BQUwsR0FBY0osQ0FBQyxDQUFDSyxZQUFGLENBQWVGLE9BQWYsQ0FBZDtBQUNEOztBQUVERyxFQUFBQSxLQUFLLENBQUNDLFFBQUQsRUFBVztBQUNkLFVBQU1DLElBQUksR0FBRyxLQUFLSixNQUFMLENBQVlJLElBQXpCO0FBQ0EsVUFBTUwsT0FBTyxHQUFHLEtBQUtDLE1BQUwsQ0FBWUQsT0FBNUI7O0FBRUEsUUFBSSxDQUFDSSxRQUFRLENBQUNFLEtBQWQsRUFBcUI7QUFBQ0MsTUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksZUFBWjtBQUE2QjtBQUFPOztBQUUxREosSUFBQUEsUUFBUSxDQUFDRSxLQUFULENBQWVHLGVBQWYsQ0FBK0JDLEdBQS9CLENBQW9DLHNCQUFwQyxFQUE0REMsV0FBRCxJQUFpQjtBQUMxRWQsTUFBQUEsQ0FBQyxDQUFDZSxJQUFGLENBQU9QLElBQUksQ0FBQ1EsR0FBTCxHQUFZLHNCQUFuQjs7QUFDQWhCLE1BQUFBLENBQUMsQ0FBQ2lCLGdCQUFGLENBQW1CVixRQUFuQixFQUE2Qk8sV0FBN0IsRUFBMENOLElBQTFDLEVBQWdETCxPQUFoRDs7QUFDQSxVQUFJSyxJQUFJLENBQUNVLFlBQUwsQ0FBa0JDLE1BQWxCLEdBQTJCLENBQS9CLEVBQWtDO0FBQ2hDTCxRQUFBQSxXQUFXLENBQUNNLE1BQVosQ0FBbUJDLElBQW5CLENBQXlCLElBQUlDLEtBQUosQ0FBVWQsSUFBSSxDQUFDVSxZQUFMLENBQWtCSyxJQUFsQixDQUF1QixFQUF2QixDQUFWLENBQXpCO0FBQ0E7QUFDRDtBQUNGLEtBUEQ7QUFTQWhCLElBQUFBLFFBQVEsQ0FBQ0UsS0FBVCxDQUFlSyxXQUFmLENBQTJCRCxHQUEzQixDQUFnQyxpQkFBaEMsRUFBbURDLFdBQUQsSUFBaUI7QUFDakVkLE1BQUFBLENBQUMsQ0FBQ2UsSUFBRixDQUFPUCxJQUFJLENBQUNRLEdBQUwsR0FBWSxrQkFBbkI7O0FBQ0FoQixNQUFBQSxDQUFDLENBQUN3QixZQUFGLENBQWVqQixRQUFmLEVBQXlCTyxXQUF6QixFQUFzQ04sSUFBdEMsRUFBNENMLE9BQTVDO0FBQ0QsS0FIRDtBQUtBSSxJQUFBQSxRQUFRLENBQUNFLEtBQVQsQ0FBZWdCLElBQWYsQ0FBb0JDLFFBQXBCLENBQThCLFVBQTlCLEVBQXlDLENBQUNaLFdBQUQsRUFBY2EsUUFBZCxLQUEyQjtBQUNsRTNCLE1BQUFBLENBQUMsQ0FBQ2UsSUFBRixDQUFPUCxJQUFJLENBQUNRLEdBQUwsR0FBWSxtQkFBbkI7O0FBQ0FoQixNQUFBQSxDQUFDLENBQUM0QixLQUFGLENBQVFyQixRQUFSLEVBQWtCTyxXQUFsQixFQUErQk4sSUFBL0IsRUFBcUNMLE9BQXJDLEVBQThDd0IsUUFBOUM7QUFDRCxLQUhEO0FBS0FwQixJQUFBQSxRQUFRLENBQUNFLEtBQVQsQ0FBZW9CLFlBQWYsQ0FBNEJoQixHQUE1QixDQUFnQyxtQkFBaEMsRUFBc0RDLFdBQUQsSUFBaUI7QUFDcEVkLE1BQUFBLENBQUMsQ0FBQ2UsSUFBRixDQUFPUCxJQUFJLENBQUNRLEdBQUwsR0FBWSxtQkFBbkI7O0FBQ0FoQixNQUFBQSxDQUFDLENBQUM4QixhQUFGLENBQWdCdkIsUUFBaEIsRUFBMEJPLFdBQTFCLEVBQXVDTixJQUF2QyxFQUE2Q0wsT0FBN0M7QUFDRCxLQUhEO0FBS0FJLElBQUFBLFFBQVEsQ0FBQ0UsS0FBVCxDQUFlc0IsSUFBZixDQUFvQmxCLEdBQXBCLENBQXlCLFVBQXpCLEVBQW9DLE1BQU07QUFDeENiLE1BQUFBLENBQUMsQ0FBQ2UsSUFBRixDQUFPUCxJQUFJLENBQUNRLEdBQUwsR0FBWSxXQUFuQjs7QUFDQWhCLE1BQUFBLENBQUMsQ0FBQ2dDLEtBQUYsQ0FBUXhCLElBQVIsRUFBY0wsT0FBZDtBQUNELEtBSEQ7QUFJRDs7QUF4Q21DIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXG5yZXF1aXJlKCdAYmFiZWwvcG9seWZpbGwnKVxuY29uc3QgcCA9IHJlcXVpcmUoYC4vcGx1Z2luVXRpbGApXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV4dFdlYnBhY2tQbHVnaW4ge1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICB0aGlzLnBsdWdpbiA9IHAuX2NvbnN0cnVjdG9yKG9wdGlvbnMpXG4gIH1cblxuICBhcHBseShjb21waWxlcikge1xuICAgIGNvbnN0IHZhcnMgPSB0aGlzLnBsdWdpbi52YXJzXG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMucGx1Z2luLm9wdGlvbnNcbiAgICBcbiAgICBpZiAoIWNvbXBpbGVyLmhvb2tzKSB7Y29uc29sZS5sb2coJ25vdCB3ZWJwYWNrIDQnKTtyZXR1cm59XG5cbiAgICBjb21waWxlci5ob29rcy50aGlzQ29tcGlsYXRpb24udGFwKGBleHQtdGhpcy1jb21waWxhdGlvbmAsIChjb21waWxhdGlvbikgPT4ge1xuICAgICAgcC5sb2doKHZhcnMuYXBwICsgYEhPT0sgdGhpc0NvbXBpbGF0aW9uYClcbiAgICAgIHAuX3RoaXNDb21waWxhdGlvbihjb21waWxlciwgY29tcGlsYXRpb24sIHZhcnMsIG9wdGlvbnMpXG4gICAgICBpZiAodmFycy5wbHVnaW5FcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb21waWxhdGlvbi5lcnJvcnMucHVzaCggbmV3IEVycm9yKHZhcnMucGx1Z2luRXJyb3JzLmpvaW4oXCJcIikpIClcbiAgICAgICAgcmV0dXJuXG4gICAgICB9XG4gICAgfSlcblxuICAgIGNvbXBpbGVyLmhvb2tzLmNvbXBpbGF0aW9uLnRhcChgZXh0LWNvbXBpbGF0aW9uYCwgKGNvbXBpbGF0aW9uKSA9PiB7XG4gICAgICBwLmxvZ2godmFycy5hcHAgKyBgSE9PSyBjb21waWxhdGlvbmApXG4gICAgICBwLl9jb21waWxhdGlvbihjb21waWxlciwgY29tcGlsYXRpb24sIHZhcnMsIG9wdGlvbnMpXG4gICAgfSlcblxuICAgIGNvbXBpbGVyLmhvb2tzLmVtaXQudGFwQXN5bmMoYGV4dC1lbWl0YCwgKGNvbXBpbGF0aW9uLCBjYWxsYmFjaykgPT4ge1xuICAgICAgcC5sb2doKHZhcnMuYXBwICsgYEhPT0sgZW1pdCAoYXN5bmMpYClcbiAgICAgIHAuX2VtaXQoY29tcGlsZXIsIGNvbXBpbGF0aW9uLCB2YXJzLCBvcHRpb25zLCBjYWxsYmFjaylcbiAgICB9KVxuXG4gICAgY29tcGlsZXIuaG9va3MuYWZ0ZXJDb21waWxlLnRhcCgnZXh0LWFmdGVyLWNvbXBpbGUnLCAoY29tcGlsYXRpb24pID0+IHtcbiAgICAgIHAubG9naCh2YXJzLmFwcCArIGBIT09LIGFmdGVyQ29tcGlsZWApXG4gICAgICBwLl9hZnRlckNvbXBpbGUoY29tcGlsZXIsIGNvbXBpbGF0aW9uLCB2YXJzLCBvcHRpb25zKVxuICAgIH0pXG5cbiAgICBjb21waWxlci5ob29rcy5kb25lLnRhcChgZXh0LWRvbmVgLCAoKSA9PiB7XG4gICAgICBwLmxvZ2godmFycy5hcHAgKyBgSE9PSyBkb25lYClcbiAgICAgIHAuX2RvbmUodmFycywgb3B0aW9ucylcbiAgICB9KVxuICB9XG59XG4iXX0=